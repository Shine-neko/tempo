{% extends "TempoAppBundle::layout.html.twig" %}
{% block bodyClass %}project show{% endblock %}
{% block container %}
{% block breadcrumb %}
    <ol id="breadcrumb" class="clearfix">
        <li class="first"> <a href="{{ path('homepage') }}">{{ 'tempo.menu.home'|trans  }}</a> </li>
        <li><a href="{{ path('project_dashboard') }}">{{ 'tempo.menu.project'|trans }}</a></li>
        <li><a href="{{ path('organization_show', {'slug' : organization.slug }) }}">{{ organization }}</a></li>

        {% if project.parent %}
            <li>
                <a href="{{ path('organization_show', {'slug' : organization.slug }) }}">{{ 'tempo.project.sub_project'|trans }} {{ project.parent }}</a>
            </li>
        {% endif %}
        <li class="last"> {{ project.name }} </li>
    </ol>
{% endblock breadcrumb %}

<div class="col-md-8 infos">
    <h1 id="page-title">
        {{ project.name }}

        {% if project.code is not null %}
            <small class="label label-default">
                {{ project.code }}
            </small>
        {% endif %}
    </h1>
    <div class="app-panel">

        <div class="pull-right">
            {% if is_granted('EDIT', organization) %}
            <a class="btn btn-xs btn-primary" href="{{ path('project_create', { 'parent' : project.id, 'organization': organization.slug }) }}"> <span class="glyphicon glyphicon-plus"></span> {{ 'tempo.project.title_subprojects'|trans }}</a>
            <a class="btn btn-xs btn-info " href="{{ path('project_update', { 'slug': project.fullSlug }) }}"> <span class="glyphicon glyphicon-edit"></span> Edit</a>
            <a class="btn btn-xs btn-primary" href="{{ path('project_settings', { 'slug': project.fullSlug }) }}"> <span class="glyphicon glyphicon-cog"></span> {{ 'tempo.project.settings'|trans }} </a>
            {% endif %}
            {% if is_granted('DELETE', project) %}
                <a class="btn btn-xs btn-danger" data-toggle="modal" data-target="#delete_project" data-title={{ 'tempo.project.title_delete'|trans }} href="{{ path('project_delete', { 'slug': project.fullSlug, 'token': csrfToken }) }}" role="dialog"> <span class="glyphicon glyphicon-trash"></span> Delete</a>
            {% endif %}
        </div>
        <div class="row">
            <div class="col-md-12">
                <ul class="nav nav-tabs" id="project-tab">
                    <li class="active">
                        <a href="#tab-project" role="tab" data-toggle="tab">{{ 'tempo.project.title'|trans }}</a>
                    </li>
                    <li>
                        <a href="#tab-sub-project" role="tab" data-toggle="tab">{{ 'tempo.project.title_subprojects'|trans }}</a>
                    </li>
                </ul>

                <div class="tab-content">
                    <div class="tab-pane active" id="tab-project">
                        {% include 'TempoAppBundle:Project/Tabs:project.html.twig' %}
                    </div>
                    <div class="tab-pane" id="tab-sub-project">
                        {% include 'TempoAppBundle:Project/Tabs:subproject.html.twig' %}
                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="commentaires-list">
        {{ render(url('comment_list', {
            'type': 'project',
            'parent' : project.id,
            'page': page,
        }))}}
    </div>
</div>
<div class="col-md-4">
    <div class="record_actions">

        <h4 class="pull-left">{{ 'tempo.organization.team'|trans }} </h4>

        <a data-toggle="modal" href="#add_membre" data-title="Adding a team member" role="dialog" class="add-member pull-right btn btn-xs btn-info"> <span class="glyphicon glyphicon-plus"></span> {{ 'tempo.project.add_membre'|trans }}</a>

        <div id="add_membre" style="display: none;">
            {% include 'TempoAppBundle:Team:new.html.twig' with {'form': teamForm, 'category': project, 'route_category' : 'project_team_add' } %}
        </div>
        <div class="app-panel clearbox">
            <div class="list_membre">
                {% include 'TempoAppBundle:Team:list.html.twig' with {
                    'route_deleted' :'project_team_delete',
                    'users': project.members,
                    'category': project
                } %}
            </div>
        </div>

        <h4 class="pull-left">{{ 'tempo.project.activity'|trans }} </h4>

        <div class="app-panel clearbox">
            {{ render(controller('TempoAppBundle:Activity:list', {'type': 'project', 'parent': project})) }}
        </div>
    </div>
</div>

<div id="delete_project" style="display: none">
    {{ 'tempo.project.msg_delete'|trans }}
</div>
    
{% endblock %}
